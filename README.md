# WordPress Form Checker Bot

A multi-threaded automated testing bot for WordPress contact forms, built with SeleniumBase and pytest. This bot validates the functionality of WordPress contact forms by filling out and submitting forms automatically, with support for CAPTCHA handling and email notifications on failures.

## Features

- ü§ñ **Multi-threaded Testing**: Parallel execution across multiple contact forms
- üîí **CAPTCHA Support**: Handles Turnstile CAPTCHA challenges
- üìß **Email Notifications**: Sends failure alerts via SMTP
- üé≠ **Human-like Behavior**: Mimics human typing patterns and delays
- üîÑ **Retry Logic**: Configurable retry attempts on failures
- üåê **Browser Extensions**: Supports browser extensions for enhanced functionality
- üìä **Detailed Logging**: Comprehensive error reporting and screenshots

## Project Structure

```
WordPress Form Checker Bot/
‚îú‚îÄ‚îÄ install.bat                 # Windows installation script
‚îú‚îÄ‚îÄ README.md                   # Project documentation
‚îú‚îÄ‚îÄ downloaded_files/           # Lock files for downloads
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ bot_orchestrator.py     # Main orchestrator for managing workers (with pytest)
‚îÇ   ‚îú‚îÄ‚îÄ bot_worker.py          # Core bot logic and form testing
‚îÇ   ‚îú‚îÄ‚îÄ utils.py               # Utility functions
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt       # Python dependencies
‚îÇ   ‚îî‚îÄ‚îÄ browser_extensions/    # Browser extension folders
```

## Requirements

- **Python 3.10.11** (specifically required)
- **Windows** (Batch support)
- **Chrome/Chromium** browser
- **Internet connection**

## Installation

### Automatic Installation (Recommended)

1. Clone or download this repository
2. Run the installation script:
   ```
   .\install.bat
   ```

The script will:
- Verify Python 3.10.11 installation
- Create a virtual environment
- Install all required dependencies
- Run the bot once as a test

### Manual Installation

1. **Verify Python Version**:
   ```powershell
   py -0p | findstr "3.10"
   ```

2. **Create Virtual Environment**:
   ```powershell
   python -m venv .venv
   .venv\Scripts\Activate.ps1
   ```

3. **Install Dependencies**:
   ```powershell
   pip install -r src/requirements.txt
   ```

## Configuration

Create a `.env` file in the `src/` directory with the following variables:

```env
# Required: Comma-separated list of contact page URLs to test
CONTACT_PAGES=https://example1.com/contact,https://example2.com/contact,https://example3.com/contact

# Optional: Bot behavior settings
MAX_WORKERS=10                    # Maximum parallel workers (default: 10)
RERUNS_ON_FAILURE=1              # Retry attempts on failure (default: 1)
USE_HEADLESS=True                # Run in headless mode (default: True)

# Optional: Email notification settings (for failure alerts)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
EMAIL_FROM=your-email@gmail.com
EMAIL_TO=alerts@yourcompany.com,admin@yourcompany.com
```

### Environment Variables Explained

| Variable | Description | Default | Required |
|----------|-------------|---------|----------|
| `CONTACT_PAGES` | Comma-separated URLs of contact forms to test | None | ‚úÖ Yes |
| `MAX_WORKERS` | Number of parallel test workers | 10 | ‚ùå No |
| `RERUNS_ON_FAILURE` | Number of retry attempts on test failure | 1 | ‚ùå No |
| `USE_HEADLESS` | Run browser in headless mode | True | ‚ùå No |
| `SMTP_HOST` | SMTP server hostname | None | ‚ùå No |
| `SMTP_PORT` | SMTP server port | 587 | ‚ùå No |
| `SMTP_USERNAME` | SMTP authentication username | None | ‚ùå No |
| `SMTP_PASSWORD` | SMTP authentication password | None | ‚ùå No |
| `EMAIL_FROM` | Sender email address | None | ‚ùå No |
| `EMAIL_TO` | Comma-separated recipient email addresses | None | ‚ùå No |

## Usage

Run the bot orchestrator:
```
cd src
.venv\Scripts\Activate.ps1
python bot_orchestrator.py
```

## How It Works

### Bot Orchestrator (`bot_orchestrator.py`)
- Manages multiple worker processes
- Configures pytest with appropriate parameters
- Handles browser extension loading
- Controls headless/non-headless execution

### Bot Worker (`bot_worker.py`)
- Implements the core form testing logic
- Handles WordPress Contact Form 7 detection
- Fills form fields with realistic fake data
- Manages CAPTCHA challenges (Turnstile)
- Sends email notifications on failures
- Implements human-like typing behavior

### Key Features

1. **Form Detection**: Automatically detects WordPress Contact Form 7 forms using `.wpcf7.js` selector

2. **Smart Form Filling**: 
   - Detects and fills name, email, subject, and message fields
   - Uses realistic fake data generated by Faker library
   - Implements human-like typing with random delays

3. **CAPTCHA Handling**:
   - Supports Cloudflare Turnstile CAPTCHA
   - Provides user interaction prompts for manual solving
   - Configurable timeout periods

4. **Error Handling**:
   - Comprehensive error reporting
   - Screenshot capture on failures
   - HTML source saving for debugging
   - Email notifications with detailed error messages

## Browser Extensions

The bot supports browser extensions located in `src/browser_extensions/`. Extensions are automatically loaded when running in non-headless mode.

Current included extension:
- **ID**: `dknlfmjaanfblgfdfebhijalfmhmjjjo` (Version 0.4.13_0)
- **Purpose**: Enhanced CAPTCHA handling

## Testing WordPress Contact Forms

The bot specifically targets **WordPress Contact Form 7** plugin forms. It:

1. **Navigates** to each specified contact page
2. **Detects** Contact Form 7 forms (`.wpcf7.js` class)
3. **Handles** cookie consent banners automatically
4. **Fills** form fields with appropriate test data:
   - Name: Generated fake names
   - Email: Generated fake email addresses
   - Subject: Test subject with unique identifiers
   - Message: Test messages with tracking IDs
5. **Solves** CAPTCHA challenges when present
6. **Submits** the form and validates responses
7. **Reports** success/failure status

### Expected Success Response

The bot looks for French success messages containing:
- "merci" (thank you)
- "envoy√©" or "envoye" (sent)

## Troubleshooting

### Common Issues

1. **Python Version Error**:
   ```
   Python 3.10 is not installed
   ```
   **Solution**: Install Python 3.10.11 from the official website

2. **Missing Environment Variables**:
   ```
   CONTACT_PAGES environment variable is not set or empty
   ```
   **Solution**: Create a `.env` file with required `CONTACT_PAGES` variable

3. **Contact Form Not Found**:
   ```
   Contact form was not found
   ```
   **Solution**: Verify the URL contains a WordPress Contact Form 7 form

4. **CAPTCHA Timeout**:
   ```
   Turnstile response was not completed after 150 seconds
   ```
   **Solution**: Increase timeout in the code so that CAPTCHA gets solved

5. **Email Sending Failed**:
   ```
   Failed to send email
   ```
   **Solution**: Verify SMTP configuration and credentials

### Debug Mode

For debugging, you can:

1. **Disable headless mode**: Set `USE_HEADLESS=False` in `.env`
2. **Reduce workers**: Set `MAX_WORKERS=1` for single-threaded execution
3. **Check generated files**: Look for `error.png` and `error.html` on failures

## Dependencies

Key Python packages (see `requirements.txt` for complete list):

- **seleniumbase**: Web automation framework
- **pytest**: Testing framework
- **faker**: Fake data generation
- **python-dotenv**: Environment variable management
- **beautifulsoup4**: HTML parsing
- **requests**: HTTP client
- **filelock**: File-based locking for multi-threading

## Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## License

This project is provided as-is for educational and testing purposes. Please ensure you have permission to test the contact forms you're targeting and comply with all applicable terms of service and legal requirements.

## Support

For issues, questions, or feature requests, please:
1. Check the troubleshooting section above
2. Review the error logs and screenshots generated
3. Verify your environment configuration
4. Test with a single worker first (`MAX_WORKERS=1`)

---

**Note**: This bot is designed for legitimate testing purposes. Always ensure you have proper authorization before testing contact forms on websites you don't own.
